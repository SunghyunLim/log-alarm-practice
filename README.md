# Intro
ì•ˆë…•í•˜ì„¸ìš”. 
ì´ë²ˆ ê³¼ì •ì—ì„œëŠ” 'ì¤‘ì•™ ì„œë²„ì— logë¥¼ ì €ì¥í•˜ëŠ” ì´ìœ 'ì™€ 'logë¥¼ ì˜ ì €ì¥í•˜ëŠ” ë²•'ì„ ì²´í—˜í•´ë³´ë ¤ê³  í•©ë‹ˆë‹¤. ì‹¤ê°ë‚˜ëŠ” ì²´í—˜ì„ ìœ„í•´ì„œ, ìš°ë¦¬ëŠ” ì•„ë˜ì™€ ê°™ì€ ìƒí™©ì— ì²˜í•´ìˆë‹¤ê³  ìƒìƒí•  ê²ë‹ˆë‹¤! ğŸ˜
```
ìš°ë¦¬íšŒì‚¬ê°€ ì˜¨ë¼ì¸ìœ¼ë¡œ ì½˜ì„œíŠ¸ êµ¿ì¦ˆë¥¼ íŒŒëŠ” ì„œë¹„ìŠ¤ë¥¼ ì‹œì‘í•œë‹¤. 
ì§€ë‚œ ëª‡ ê°œì›”ë™ì•ˆ ì—´ì‹¬íˆ ê°œë°œí–ˆê³  ìµœì¢… QAë„ ë§ˆì³¤ê³ , ì§€ë‚œì£¼ì— ë°°í¬ë„ ë˜ì–´ìˆë‹¤. 
ëª¨ë“  ê²ƒì´ ë‹¤ ì™„ë²½í•˜ë‹¤.
ë“œë””ì–´ ì˜¤ëŠ˜ ì €ë… ì•„í™‰ì‹œì— BTS ì½˜ì„œíŠ¸ê°€ ìˆë‹¤! íœë“¤ê³¼ í•¨ê»˜í•˜ëŠ” ìš°ë¦¬ êµ¿ì¦ˆ ì„œë¹„ìŠ¤!! 
ê·¸ëŸ°ë°, CTOì™€ íŒ€ì¥ë‹˜ë“¤ì€ í•´ì™¸ì¶œì¥ì„ ê°”ë‹¤ã… ã… ê·¸ë“¤ì€ ë¹„í–‰ê¸° ì•ˆì— ìˆë‹¤.
ì´ì œ ìš°ë¦¬ë¼ë¦¬ ì˜¤ëŠ˜ ì˜¤í›„ì— ì„œë¹„ìŠ¤ë¥¼ ì˜¤í”ˆí•´ì•¼ í•˜ëŠ”ë°...ì´ì œ, ìš°ë¦¬ íŒ€ ë­˜ í•´ì•¼ í•˜ì§€?
```

## ë¯¸ì…˜ ë°°ê²½ ì„¤ëª…
- ì¸ê¸° ë§ì€ ì„œë¹„ìŠ¤ëŠ” ì—¬ëŸ¬ëŒ€ì˜ ì„œë²„ë¥¼ ë‘ê³  ìš´ì˜í•©ë‹ˆë‹¤. ìš°ë¦¬ëŠ” ì¸ê¸° ë§ì€ ì„œë¹„ìŠ¤ê°€ ë ê±°ë‹ˆê¹Œ, ì—¬ëŸ¬ëŒ€ì˜ ì„œë²„ê°€ í•„ìš”í•´ìš”!
![ì—¬ëŸ¬ëŒ€ ì„œë²„ì˜ˆì‹œ](https://docs.oracle.com/it/solutions/design-ha/img/public-lb.png)
- ì´ë²ˆ ë¯¸ì…˜ì—ì„œ ì—¬ëŸ¬ë¶„ì˜ local PCëŠ” ìš°ë¦¬ì„œë¹„ìŠ¤ì˜ ì—¬ëŸ¬ëŒ€ì˜ ì„œë²„ ì¤‘ í•˜ë‚˜ì˜ ì„œë²„ instanceì˜ ì—­í• ì„ í•œë‹¤ê³  ìƒê°í•´ì£¼ì„¸ìš”!    
(ìœ„ ê·¸ë¦¼ì—ì„œ VM1, VM2, VM3 ì´ ê°ìì˜ local PCì™€ ê°™ì€ ì—­í• ì´ì—ìš”.)
- ì œê³µë˜ëŠ” ë¯¸ì…˜ repoì— ìˆëŠ” 'mock-server.py'ë¥¼ ì‹¤í–‰í•˜ë©´, logListì— ë¡œê·¸ë“¤ì´ ëœë¤í•˜ê²Œ ë¡œê·¸íŒŒì¼ì— ìƒì„±ë  ê²ƒì…ë‹ˆë‹¤.    
(cf.ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œë„ ì„œë²„ë¥¼ ì‹¤í–‰í•˜ë©´ ë§ì€ ë¡œê·¸ë“¤ì´ ë¡œê·¸íŒŒì¼ì— ìŒ“ì´ê¸° ì‹œì‘í•©ë‹ˆë‹¤.)
- ìš°ë¦¬ëŠ” ì´ ë¯¸ì…˜ì—ì„œ datadog(https://www.datadoghq.com/) ì´ë¼ëŠ” ìƒìš© ì¤‘ì•™ ë¡œê·¸ ì‹œìŠ¤í…œì˜ ë„ì›€ì„ ë°›ì„ ê±°ì—ìš”! datadogì€ logë¥¼ ì¤‘ì•™ì„œë²„ì— ìˆ˜ì§‘í•´ì£¼ëŠ” ê³ ë§ˆìš´ ì¹œêµ¬ì…ë‹ˆë‹¤. 

## ë¯¸ì…˜ ì¤€ë¹„ë¬¼
**1. python 3**
- python ë²„ì „ 3ì´ìƒì´ í•„ìš”í•´ìš”!
- mac OSë¼ë©´, brewë¥¼ í†µí•´ ì„¤ì¹˜í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤.
- python3ì´ ì„¤ì¹˜ë˜ì–´ìˆëŠ”ì§€ í„°ë¯¸ë„ì—ì„œ í™•ì¸í•´ë³¼ê¹Œìš”?     
Hint : `python3 --version` 

**2. datadog agent ì„¤ì¹˜**
- mac OS  
ì•„ë˜ ëª…ë ¹ì–´ë¥¼ í†µí•´ ì„¤ì¹˜ 
```
DD_AGENT_MAJOR_VERSION=7 DD_API_KEY={ì œê³µë˜ëŠ” key} DD_SITE="datadoghq.com" bash -c "$(curl -L https://s3.amazonaws.com/dd-agent/scripts/install_mac_os.sh)"
```
![ì„±ê³µê²°ê³¼](https://github.com/SunghyunLim/log-alarm-practice/blob/main/img/result.png)

- windows 
ì„¤ì¹˜ì‹œ í•„ìš”í•œ API keyëŠ” ë³„ë„ë¡œ ì œê³µ í•„ìš”
// todo windowsì—ì„œë„ ì„¤ì¹˜ë§Œ í•˜ë©´, ì´í›„ í™˜ê²½ë³€ìˆ˜ ì„¤ì •ì‹œ pathê°€ ë˜‘ê°™ì„ê¹Œ? í™•ì¸í•„ìš”.
https://docs.datadoghq.com/agent/basic_agent_usage/windows/?tab=gui

**3. DD_API_KEY**
- ê°•ì˜ì—ì„œ ì œê³µ ì˜ˆì •  

**4. datadog ID, PASSWORD**
- ê°•ì˜ì—ì„œ ì œê³µ ì˜ˆì •

### P.S : Don't Worry!
- ì´ ë¯¸ì…˜ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ì„œ python ë¬¸ë²•ì„ ëª°ë¼ë„ ë©ë‹ˆë‹¤. ê±±ì •ë§ˆì„¸ìš”ğŸ¥³
- ì´ ë¯¸ì…˜ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ì„œ datadog ì´ ë­”ì§€, ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠ”ì§€ ì˜ ëª°ë¼ë„ ë©ë‹ˆë‹¤. ê±±ì •ë§ˆì„¸ìš”ğŸ¥³
----------
## ë¯¸ì…˜ 1. ë‚˜ì˜ local í™˜ê²½ì—ì„œ, logë¥¼ í™•ì¸í•˜ê¸°
### step1. git clone
- ì´ í”„ë¡œì íŠ¸ë¥¼ clone í•©ë‹ˆë‹¤.
- cloneí•œ í”„ë¡œì íŠ¸ê°€ ìœ„ì¹˜í•œ pathë¥¼ ë©”ëª¨í•´ë‘ì„¸ìš”. ì´í›„ì— ë‚˜ì˜¬ ë¯¸ì…˜ì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤.
Hint! `pwd`     

### step2. 'mock-server.py'ë¥¼ ì‹¤í–‰í•˜ê¸°
- cloneí•œ í”„ë¡œì íŠ¸ì—ì„œ ì•„ë˜ ëª…ë ¹ì–´ ì‹¤í–‰
```
python3 mock-server.py
```
- ì•„ë˜ ìŠ¤í¬ë¦°ìƒ·ì²˜ëŸ¼ ë¡œê·¸ê°€ í”„ë¦°íŠ¸ ë˜ë©´ ë¯¸ì…˜ 1 ì„±ê³µ!
// todo ì„±ê³µì‹œ ì´ë¯¸ì§€ ì¶”ê°€

----
## Q. ì§€ê¸ˆ ìƒíƒœì—ì„œ ë‹¤ë¥¸ ì„œë²„(ìš°ë¦¬ íŒ€ì›)ì˜ ë¡œê·¸ë¥¼ ë³¼ ìˆ˜ ìˆë‚˜ìš”? ë‹¤ë¥¸ íŒ€ì˜ ì„œë²„ë¥¼ ë¹¼ê³  ìš°ë¦¬ íŒ€ë§Œì˜ ì„œë²„ë¥¼ ë³´ê³ ì‹¶ë‹¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œìš”?
----
## ë¯¸ì…˜ 2. ë‹¤ë¥¸ ì„œë²„ì˜ ë¡œê·¸ë„ ë³´ê¸°ìœ„í•´ì„œ, ë¡œê·¸ë¥¼ ì¤‘ì•™ì„œë²„ë¡œ ë³´ëƒ…ì‹œë‹¤. datadogì˜ ë„ì›€ì„ ë°›ì„ ê±°ì—ìš”.

### step1. datadog í™˜ê²½ë³€ìˆ˜ ë³€ê²½
- /opt/datadog-agent/etc/datadog.yamlíŒŒì¼ì„ ì°¾ê¸°
- '/opt/datadog-agent/etc/datadog.yaml'íŒŒì¼ì˜ 835ë²ˆì§¸ ë¼ì¸ì„ ì°¾ê³ , ì•„ë˜ì™€ ê°™ì´ ë³€ê²½í•˜ê³  ì €ì¥í•˜ê¸°       
 ``` logs_enabled: true ```  
 
ë³€ê²½ ì „ -> ë³€ê²½ í›„
 ``` logs_enabled: false -> logs_enabled: true ```

### step2. logì— í‘œì‹œë  ë‚˜ë§Œì˜ ì„œë¹„ìŠ¤ ì´ë¦„ ë§Œë“¤ê¸°
- /opt/datadog-agent/etc/conf.d/python.d ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±í•˜ê¸°
- ìœ„ì—ì„œ ìƒì„±í•œ ë””ë ‰í† ë¦¬ì— 'conf.yaml'íŒŒì¼ì„ ìƒì„±í•´ì„œ ì•„ë˜ ë‚´ìš©ì„ ì¶”ê°€í•˜ê³  ì €ì¥í•©ë‹ˆë‹¤.
 ```
 logs:
  - type: file
    path: {git cloneí•œ ìœ„ì¹˜}/logs/*.log
    service: {ë‚˜ë§Œì˜ ì„œë¹„ìŠ¤ ì´ë¦„}
    source: python
```

'conf.yaml' Example
```
logs:
 - type: file
   path: /Users/whale/solar/log-alarm-practice/logs/*.log
   service: solar
   source: python
```

### step3. datadog-agentë¥¼ ì¬ì‹œì‘ í•©ë‹ˆë‹¤.
- datadog-agent ì¢…ë£Œ
```
datadog-agent stop
```

- datadog-agent ì‹œì‘
```
datadog-agent run
```
- datadog-agentê°€ ì •ìƒì ìœ¼ë¡œ ì‹œì‘ë˜ë©´, ì„±ê³µ!
  - datadog-agentê°€ ì‹¤í–‰ë˜ë©´, ë¡œê·¸íŒŒì¼ì„ ì¤‘ì•™ì„œë²„ë¡œ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!
// todo ì •ìƒì ìœ¼ë¡œ ì‹œì‘ë˜ì—ˆì„ë•Œ ìŠ¤ìƒ· ì¶”ê°€

### step4. mock-server ì‹¤í–‰
- python3 mock-server.py ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
  - ë¯¸ì…˜1.step2ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.
----------
## ë¯¸ì…˜3. datadogì„ í™œìš©í•´ ë‚˜ì˜ log í™•ì¸í•˜ê¸°
- datadog login
`https://app.datadoghq.com/account/login`

- ë¡œê·¸ì¸ í›„, ì¢Œì¸¡ ë©”ë‰´ ì¤‘ Logs > Search

- ìˆ˜ ë§ì€ logì¤‘ì—ì„œ ë‚˜ì˜ logë§Œ ì°¾ì•„ë‚¼ ìˆ˜ ìˆë‹¤ë©´, ë¯¸ì…˜ ì„±ê³µ!
 
----------
# datadog ì‚­ì œ
ë‹¤ìŒì˜ ì ˆì°¨ì— ë”°ë¼ ì§„í–‰í•˜ì„¸ìš”.
```
sudo rm -rf /opt/datadog-agent
sudo rm -rf /usr/local/bin/datadog-agent
sudo rm -rf ~/.datadog-agent/** #to remove broken symlinks
launchctl remove com.datadoghq.agent
sudo rm -rf /var/log/datadog
```
